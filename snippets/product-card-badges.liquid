{%- doc -%}
  Renders product badges and pricing for the product card.
{%- enddoc -%}

{%- assign on_sale = false -%}

{%- if product.available and product.compare_at_price > product.price -%}
  {%- assign on_sale = true -%}
  {%- assign discount = product.compare_at_price
    | minus: product.price
    | times: 100
    | divided_by: product.compare_at_price
  -%}
{%- endif -%}

<!-- BADGES -->
<div
  class="product-badges product-badges--{{ settings.badge_position }}"
  style="
    --badge-border-radius: {{ settings.badge_corner_radius }}px;
    --badge-font-family: var(--font-{{ settings.badge_font_family }}--family);
    --badge-font-weight: var(--font-{{ settings.badge_font_family }}--weight);
    --badge-text-transform: {{ settings.badge_text_transform }};
  "
>
  {%- if product.available == false or on_sale -%}
    <div
      class="
        product-badges__badge product-badges__badge--rectangle
        {% if product.available == false %}
          color-{{ settings.badge_sold_out_color_scheme }}
        {% else %}
          color-{{ settings.badge_sale_color_scheme }}
        {% endif %}
      "
    >
      {%- if product.available == false -%}
        {{ 'content.product_badge_sold_out' | t }}
      {%- else -%}
        -{{ discount }}%
      {%- endif -%}
    </div>
  {%- endif -%}
</div>

<!-- PRICE -->
<div class="product-price">
  {%- if on_sale -%}
    <span class="product-price__old">
      {{ product.compare_at_price | money }}
    </span>
    <span class="product-price__new">
      {{ product.price | money }}
    </span>
  {%- else -%}
    <span class="product-price__new">
      {{ product.price | money }}
    </span>
  {%- endif -%}
</div>

{% stylesheet %}
  .product-badges {
    position: absolute;
    z-index: var(--layer-flat);
  }

  .product-badges__badge {
    padding: 6px 10px;
    font-size: var(--font-size--xs);
    border-radius: var(--badge-border-radius);
  }

  .product-price {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-top: 6px;
  }

  .product-price__old {
    text-decoration: line-through;
    color: #888;
    font-size: 0.9em;
  }

  .product-price__new {
    font-weight: 600;
  }
{% endstylesheet %}
